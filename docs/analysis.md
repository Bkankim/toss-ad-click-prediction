# 데이터 분석 & EDA
CTR 데이터의 분포와 특징을 요약하고, 프로젝트에서 작성했던 상세 분석 리포트를 압축해 요약했습니다. 자동 생성된 원문은 하단 부록으로 제공하며, 최신 리포트로 교체할 수 있습니다.

## 1. 분석 개요
- 목적: 데이터 분포와 피처 특성을 파악해 모델링 전략을 수립.
- 자료: 원본 `train.parquet` 샘플(30만 row) + 200만 행 상관관계 샘플, 자동 리포트 생성기 `src/eda/report_generator.py`.
- 산출물: 요약 통계, 시간/요일별 클릭률 패턴, 시퀀스 길이·다양성 분석, 상관 행렬, 중요도/교차 검정 결과.

## 2. 핵심 인사이트 요약
### 2.1 시간·요일 패턴
- 전체 평균 클릭률(AP)은 **1.91%**이며, 화요일(0.0209) > 수요일(0.0196) > 목요일(0.0198) 순으로 높습니다.
- 새벽 02~04시는 클릭률이 0.022~0.023 수준으로 가장 활발하고, 오전 07~09시는 0.017대로 급락합니다.
- 테스트 데이터는 day7=일요일 100%이므로 day7 holdout / 가중치 실험이 필요하며, 지나친 가중치는 LB 하락으로 이어졌습니다.

### 2.2 시퀀스 길이·다양성
- `seq_length` 평균 530, 중앙값 439. 길이가 짧을수록 클릭률이 높아(0~9 토큰 4.6%, 500~999 토큰 1.7%) cold-start 대응이 중요합니다.
- diversity_ratio 0.4 이상 구간에서 클릭률이 3% 이상으로 상승해, 시퀀스 다양성 파생(`unique_count`, `diversity_ratio`)이 모델에 기여합니다.

### 2.3 피처 중요성 & 공선성
- `history_a_*`, `history_b_*`, `inventory_id` 계열이 타깃과 가장 높은 상관(0.05~0.14)을 보입니다.
- `history_b_*`, `l_feat_*`는 완전 상관 그룹이 다수이므로 핵심 컬럼만 유지하고 나머지는 제거합니다.
- 카이제곱 검정 결과 `inventory_id`, `age_group`, `day_of_week`, `hour`, `gender` 순으로 범주형 영향도가 큽니다.
- SHAP/Permutation Top 10은 `history_a_1`, `inventory_id__X__age_group_te`, `inventory_id__X__gender_te`, `feat_e_3`, `day_of_week__X__hour_te` 등 타깃 인코딩 조합이 우세했습니다.

### 2.4 결측 및 품질
- 대부분의 피처 결측률은 0.16% 이하이나 `feat_e_3`는 10.1%로 높습니다. 결측 플래그와 별도 대체 전략을 유지합니다.
- 이상치(시퀀스 길이 5천 이상)는 0.001% 수준으로 영향이 미미하지만 추론 전처리 단계에서 클리핑합니다.

## 3. 수동 탐색 노트 요약
- **상관관계 정리(2025-10-06)**: `history_b_2/30/1/10/17`을 핵심으로 유지, 나머지는 drop 후보. 공선성 그룹 제거 시 상위 0.99 이상 상관쌍이 333 → 0으로 감소했습니다.
- **시퀀스 다양성**: 평균 고유 아이템 수 52.7, diversity_ratio 0.18. 상위 버킷(>0.6)에서 클릭률이 3.3~3.8%로 상승.
- **Phase A 중요도 분석**: 1:2 다운샘플 + seq 파생 데이터 기준 OOF Score 0.523(+0.027). SHAP/Permutation 모두 타깃 인코딩·history 피처가 상위권을 차지했습니다.

## 4. 리스크 및 편향 분석
- **데이터 편향**: 주말/야간 샘플 비중이 높아 평일 낮 사용자 과소예측 가능성이 있습니다. day7 holdout과 temperature scaling을 활용합니다.
- **Cold-start 이슈**: 짧은 시퀀스 사용자에서 높은 CTR이 관측되므로 신규 사용자 메타 피처(가입일, 첫 노출 등)가 향후 과제로 남아 있습니다.
- **드리프트**: Phase B 데이터 스킴 변경 가능성을 대비해 파생 피처 생성 시 기준일·버전을 메타데이터로 기록합니다.

## 5. 향후 분석 TODO
- seq 임베딩(latent distance) 기반 추가 통계 검토.
- day7 특화 피처 2종 이상 추가 발굴 및 중요도 검증.
- day7 holdout을 활용한 후처리(temperature scaling 등) 안정성 검토.

## 부록: 자동 생성 EDA 리포트 원문
<details>
<summary>2025-09-30 자동 리포트 (샘플 300,000)</summary>

# 자동 생성 EDA 리포트
- 생성 일시: 2025-09-30 16:58:47 UTC
- 샘플 크기: 300,000 (shuffle sample)
- 데이터 경로: `data/train.parquet`

## 데이터 개요
| metric | value |
| --- | --- |
| rows | 10,704,179 |
| clicks | 204,179 |
| click_rate | 0.019075 |

## 요일(day_of_week)별 클릭 통계
| day_of_week | rows | clicks | click_rate |
| --- | --- | --- | --- |
| 1 | 1525483 | 25483 | 0.016705 |
| 2 | 1532022 | 32022 | 0.020902 |
| 3 | 1529921 | 29921 | 0.019557 |
| 4 | 1530297 | 30297 | 0.019798 |
| 5 | 1529839 | 29839 | 0.019505 |
| 6 | 1530282 | 30282 | 0.019789 |
| 7 | 1526335 | 26335 | 0.017254 |

## 시간(hour)별 클릭 통계
| hour | rows | clicks | click_rate |
| --- | --- | --- | --- |
| 00 | 536658 | 9860 | 0.018373 |
| 01 | 172955 | 3527 | 0.020393 |
| 02 | 98671 | 2214 | 0.022438 |
| 03 | 78649 | 1820 | 0.023141 |
| 04 | 110006 | 2337 | 0.021244 |
| 05 | 273189 | 5464 | 0.020001 |
| 06 | 477708 | 9119 | 0.019089 |
| 07 | 603023 | 10645 | 0.017653 |
| 08 | 755311 | 13468 | 0.017831 |
| 09 | 587434 | 10384 | 0.017677 |
| 10 | 576432 | 9795 | 0.016992 |
| 11 | 512721 | 9410 | 0.018353 |
| 12 | 607775 | 11257 | 0.018522 |
| 13 | 502610 | 9984 | 0.019864 |
| 14 | 439980 | 8950 | 0.020342 |
| 15 | 417579 | 8645 | 0.020703 |
| 16 | 421292 | 8662 | 0.020561 |
| 17 | 448382 | 9255 | 0.020641 |
| 18 | 493294 | 10025 | 0.020323 |
| 19 | 569826 | 10629 | 0.018653 |
| 20 | 584545 | 10907 | 0.018659 |
| 21 | 541590 | 10604 | 0.019579 |
| 22 | 480611 | 9192 | 0.019126 |
| 23 | 413938 | 8026 | 0.019389 |

## 시퀀스 길이 요약
| mean | median | min | max | q1 | q3 |
| --- | --- | --- | --- | --- | --- |
| 552.36 | 460.00 | 1 | 6590 | 195.00 | 807.00 |

### 시퀀스 길이 구간별 클릭률
| seq_bucket | rows | clicks | click_rate |
| --- | --- | --- | --- |
| 500-999 | 93298 | 1599 | 0.017139 |
| 250-499 | 67916 | 1223 | 0.018008 |
| 100-249 | 49971 | 1023 | 0.020472 |
| 1000-2499 | 46012 | 780 | 0.016952 |
| 50-99 | 19993 | 509 | 0.025459 |
| 25-49 | 10697 | 302 | 0.028232 |
| 10-24 | 6712 | 254 | 0.037843 |
| 0-9 | 4791 | 222 | 0.046337 |
| 2500-4999 | 602 | 15 | 0.024917 |
| 5000-9999 | 8 | 1 | 0.125000 |

## 사이클릭 피처 분석
사이클릭 변환(day/hour)에 대한 평균 sin/cos 값과 클릭률 추세입니다.

### 요일 사이클릭 평균
| day_of_week | rows | click_rate | mean_sin | mean_cos |
| --- | --- | --- | --- | --- |
| 1 | 1525483 | 0.016705 | 0.000000 | 1.000000 |
| 2 | 1532022 | 0.020902 | 0.781831 | 0.623490 |
| 3 | 1529921 | 0.019557 | 0.974928 | -0.222521 |
| 4 | 1530297 | 0.019798 | 0.433884 | -0.900969 |
| 5 | 1529839 | 0.019505 | -0.433884 | -0.900969 |
| 6 | 1530282 | 0.019789 | -0.974928 | -0.222521 |
| 7 | 1526335 | 0.017254 | -0.781831 | 0.623490 |

### 시간 사이클릭 평균
| hour | rows | click_rate | mean_sin | mean_cos |
| --- | --- | --- | --- | --- |
| 00 | 536658 | 0.018373 | 0.000000 | 1.000000 |
| 01 | 172955 | 0.020393 | 0.258819 | 0.965926 |
| 02 | 98671 | 0.022438 | 0.500000 | 0.866025 |
| 03 | 78649 | 0.023141 | 0.707107 | 0.707107 |
| 04 | 110006 | 0.021244 | 0.866025 | 0.500000 |
| 05 | 273189 | 0.020001 | 0.965926 | 0.258819 |
| 06 | 477708 | 0.019089 | 1.000000 | 0.000000 |
| 07 | 603023 | 0.017653 | 0.965926 | -0.258819 |
| 08 | 755311 | 0.017831 | 0.866025 | -0.500000 |
| 09 | 587434 | 0.017677 | 0.707107 | -0.707107 |
| 10 | 576432 | 0.016992 | 0.500000 | -0.866025 |
| 11 | 512721 | 0.018353 | 0.258819 | -0.965926 |
| 12 | 607775 | 0.018522 | 0.000000 | -1.000000 |
| 13 | 502610 | 0.019864 | -0.258819 | -0.965926 |
| 14 | 439980 | 0.020342 | -0.500000 | -0.866025 |
| 15 | 417579 | 0.020703 | -0.707107 | -0.707107 |
| 16 | 421292 | 0.020561 | -0.866025 | -0.500000 |
| 17 | 448382 | 0.020641 | -0.965926 | -0.258819 |
| 18 | 493294 | 0.020323 | -1.000000 | -0.000000 |
| 19 | 569826 | 0.018653 | -0.965926 | 0.258819 |
| 20 | 584545 | 0.018659 | -0.866025 | 0.500000 |
| 21 | 541590 | 0.019579 | -0.707107 | 0.707107 |
| 22 | 480611 | 0.019126 | -0.500000 | 0.866025 |
| 23 | 413938 | 0.019389 | -0.258819 | 0.965926 |

</details>
