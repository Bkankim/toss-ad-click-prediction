# 프로젝트 개요
토스 NEXT ML Challenge CTR 예측 대회 참가 프로젝트로, 광고 클릭 확률을 정밀하게 추정해 리더보드 상위권을 목표로 한 파이프라인을 정리합니다. 프로젝트 전반에서 작성한 PRD와 히스토리 기록을 압축해 핵심만 담았습니다.

## 1. 문제 정의
- **목표**: 광고 노출 로그를 기반으로 각 impression의 클릭 확률(CTR)을 예측하고, 평가 지표 `Score = 0.5 × AP + 0.5 × (1 / (1 + WLL))`를 극대화합니다.
- **데이터 특징**: 학습 10,704,179행( clicked=1 약 204k )·119컬럼, 테스트 1,527,298행·118컬럼. 테스트는 **day_of_week=7 100%** 구성이라 day7 전용 holdout 검증이 필수입니다. `seq`는 최대 1.4만 토큰까지 늘어나 시퀀스 길이·다양성 파생이 핵심입니다.
- **제약**: 외부 데이터 사용 불가, 2025-09-08 이전 공개 모델만 사용, 제출 파일 용량/횟수 제한(1일 3회), GPU 사용 권장.
- **비즈니스 가치**: CTR 예측 향상은 광고 예산 효율화와 사용자 경험 개선으로 직결됩니다.

## 2. 목표 및 성과 지표
| 구분 | AP (내부) | 대비 개선 | 비고 |
| --- | --- | --- | --- |
| 초기 샘플 베이스라인 (`20251006_1408_lgbm_1m`) | 0.2069 | 기준 | 100만 샘플, 기본 파라미터 |
| 다운샘플 베이스라인 (`20251008_032422`) | 0.5807 | +0.374 | 1:2 다운샘플, 1000 라운드 |
| Phase A 최종 (`20251011_221557`) | **0.6104** | +0.403 | Calibration 포함, CUDA 학습, Public LB 0.34126 |

- PRD 성공 지표: Private Score ≥ 0.700, Public AP ≥ 0.500, WLL ≤ 0.320, 내부·Public 격차 ±0.020. 현재 Phase A 최종 실험이 가장 근접합니다.
- Weighted LogLoss는 0.675 → 0.621 수준으로 감소해 안정성 또한 개선되었습니다.
- 최종 Private 리더보드에서는 Top 10% 성적을 기록했습니다.

## 3. 접근 전략 요약
1. **데이터 전처리**: `src/data/downsampling.py`로 층화 다운샘플을 생성해 클래스 불균형을 완화하고, 히스토리 문서에서 정의된 7일 특화 스크립트(`scripts/build_day7_*`)로 day7 차이를 보정합니다.
2. **특징 공학**: 시퀀스 길이·다양성, 시간 주기, 사용자×광고 히스토리를 수치화합니다. 완전 상관 그룹(`history_b_*`, `l_feat_*`)은 제거 리스트로 관리합니다.
3. **모델링**: LightGBM GPU 학습을 기본으로 Optuna 탐색(`src/training/optuna_tuner.py`)과 Phase별 엔트리(`src/training/phase_a.py`)를 분리해 재현성을 확보합니다.
4. **Calibration & 후처리**: Raw > Platt > Isotonic 순으로 LB가 하락하는 것이 확인되어 temperature scaling 등은 보조 전략으로 관리합니다.
5. **재현성**: `logs/metrics/*.csv`와 `docs/experiments.md`를 연결해 실험 → 제출 → 문서 업데이트 루프를 유지합니다.

## 4. 시스템 구조 개요
```mermaid
graph TD
    A[원본 데이터] --> B[전처리 스크립트]
    B --> C[파생 데이터 (clean_*)]
    C --> D[LightGBM 학습]
    D --> E[Calibration]
    E --> F[제출 파일 생성]
    D --> G[실험 로그 저장]
    G --> H[docs/experiments.md]
    C --> I[docs/analysis.md]
```
- 각 노드의 세부 명령은 `docs/pipeline.md`에, 운영 절차는 `docs/operations.md`에 정리되어 있습니다.

## 5. 향후 보완 계획
- **Phase B 준비**: 최신 데이터 스킴 반영, 시간 기반 drift 대응 피처 추가.
- **모델 고도화**: CatBoost/TabNet 등 다른 모델과의 앙상블 검토, LightGBM 파라미터 자동화.
- **MLOps 확장**: DVC 또는 MLflow 연동으로 대용량 아티팩트 버전 관리, CI 환경에서 스모크 테스트 자동화.
- **문서 마일스톤**: 리더보드 점수 확정 후 `docs/experiments.md` 업데이트, 발표용 슬라이드 초안 제작.
